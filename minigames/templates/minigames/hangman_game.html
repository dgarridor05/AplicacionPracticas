{% extends "base.html" %}
{% block title %}Ahorcado - Adivina el nombre completo{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">

  <div class="text-center mb-4">
    {% if total %}
    <div class="d-inline-block px-4 py-2 bg-light rounded-pill border shadow-sm">
      <span class="text-muted small fw-bold text-uppercase me-2">PuntuaciÃ³n:</span>
      <span class="fw-bold" style="color: var(--color-blue-dark);">{{ correct }} / {{ total }}</span>
    </div>
    {% endif %}
  </div>

  <div class="card shadow-soft border-0 mb-4" style="border-radius: var(--border-radius-xl);">
    <div class="card-body p-4 text-center">
      <h3 class="mb-4 fw-bold" style="color: var(--color-blue-dark);">
        ðŸŽ¯ Ahorcado
      </h3>

      <div class="mb-4 position-relative d-inline-block">
        {% if current_student.profile_picture %}
        <img src="{{ current_student.profile_picture.url }}" class="rounded-circle shadow"
          style="width: 140px; height: 140px; object-fit: cover; border: 4px solid white; outline: 3px solid var(--color-blue-dark);"
          alt="Foto del alumno">
        {% else %}
        <div class="bg-light rounded-circle shadow-sm d-flex align-items-center justify-content-center mx-auto"
          style="width: 140px; height: 140px; border: 4px solid white; outline: 3px solid #dee2e6;">
          <i class="fas fa-user fa-4x text-muted"></i>
        </div>
        {% endif %}
      </div>

      <!-- Hangman Status -->
      <div class="card border-0 bg-light mb-4 shadow-sm" style="border-radius: var(--border-radius-lg);">
        <div class="card-body py-2">
          <div class="d-flex align-items-center justify-content-center">
            <div class="me-3 fw-bold small text-uppercase text-muted">Intentos:</div>
            <div class="progress flex-grow-1" style="height: 10px; border-radius: 5px;">
              {% with used=incorrect_count max=max_incorrect %}
              {% widthratio used max 100 as percentage %}
              <div class="progress-bar {% if percentage|add:'0' > 70 %}bg-danger{% else %}bg-success{% endif %}"
                role="progressbar" style="width: {{ percentage }}%;" aria-valuenow="{{ used }}" aria-valuemin="0"
                aria-valuemax="{{ max }}"></div>
              {% endwith %}
            </div>
            <div class="ms-3 fw-bold" style="min-width: 40px;">{{ incorrect_count }}/{{ max_incorrect }}</div>
          </div>

          <div class="hangman-visual mt-2 fw-bold"
            style="font-family: monospace; font-size: 1.5rem; letter-spacing: 2px;">
            {% if incorrect_count >= 1 %}ðŸ˜µ{% else %}ðŸ˜Š{% endif %}
          </div>
        </div>
      </div>

      <div class="mb-5 py-3">
        <h2 class="text-primary fw-bold mb-0"
          style="font-family: 'Montserrat', monospace; letter-spacing: 0.3em; font-size: 2rem; word-break: break-word; color: var(--color-blue-dark) !important;">
          {{ displayed_name }}
        </h2>
      </div>

      {% if not game_over %}
      <form method="POST" class="mb-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="guess_letter">

        <p class="text-muted small mb-3">Selecciona una letra:</p>
        <div class="d-flex flex-wrap justify-content-center gap-2">
          {% for letter in alphabet %}
          {% if letter in used_letters %}
          <button type="button" class="btn btn-light btn-sm fw-bold border" disabled
            style="width: 36px; height: 36px; border-radius: 8px; opacity: 0.5;">
            {{ letter }}
          </button>
          {% else %}
          <button type="submit" name="letter" value="{{ letter }}"
            class="btn btn-outline-primary btn-sm fw-bold shadow-sm"
            style="width: 36px; height: 36px; border-radius: 8px; border-color: var(--color-blue-dark); color: var(--color-blue-dark);">
            {{ letter }}
          </button>
          {% endif %}
          {% endfor %}
        </div>
      </form>

      <div class="alert bg-light border-0 small text-muted rounded-3 mt-4">
        <i class="fas fa-lightbulb text-warning me-1"></i>
        <strong>Pista:</strong> Las letras con tilde se descubren automÃ¡ticamente al elegir la vocal simple.
      </div>

      {% else %}
      <div class="mb-4">
        {% if won %}
        <div class="alert alert-success border-0 shadow-sm" style="border-radius: var(--border-radius-lg);">
          <h4 class="alert-heading fw-bold"><i class="fas fa-trophy"></i> Â¡Correcto!</h4>
          <p class="mb-0">Era: <strong>{{ target_name }}</strong></p>
        </div>
        {% else %}
        <div class="alert alert-danger border-0 shadow-sm" style="border-radius: var(--border-radius-lg);">
          <h4 class="alert-heading fw-bold"><i class="fas fa-times-circle"></i> Â¡Fin del juego!</h4>
          <p class="mb-0">La respuesta era: <strong>{{ target_name }}</strong></p>
        </div>
        {% endif %}
      </div>

      <form method="POST" class="mb-3">
        {% csrf_token %}
        <input type="hidden" name="action" value="new_game">
        <button type="submit" class="btn btn-success btn-lg rounded-pill shadow w-100">
          <i class="fas fa-redo me-2"></i> Siguiente Alumno
        </button>
      </form>
      {% endif %}

    </div>
  </div>

  <div class="text-center mt-4 mb-5">
    <a href="{% url 'teacher_home' %}" class="btn btn-outline-secondary rounded-pill px-4">
      <i class="fas fa-home me-2"></i> Volver al panel
    </a>
  </div>

</div>

<style>
  .btn-outline-primary:hover {
    background-color: var(--color-blue-dark) !important;
    color: white !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
  }

  .btn-outline-primary:active {
    transform: scale(0.95);
  }
</style>
{% endblock %}