{% extends "base.html" %}
{% load static %}
{% block title %}Ahorcado | RELACIONA{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">

  <!-- Score Board -->
  <div class="text-center mb-4 animate-slide-up">
    {% if total %}
    <div class="d-inline-flex align-items-center px-4 py-2 bg-white rounded-pill shadow-sm border">
      <span class="text-muted small fw-bold text-uppercase me-2" style="letter-spacing: 1px;">Puntuaci√≥n</span>
      <span class="fw-bold fs-5 text-primary">{{ correct }} / {{ total }}</span>
    </div>
    {% endif %}
  </div>

  <div class="card card-glass shadow-lg border-0 animate-slide-up delay-100">
    <div class="card-body p-4 text-center">

      <!-- Header -->
      <h3 class="mb-4 fw-bold font-heading text-primary d-flex align-items-center justify-content-center gap-2">
        <span class="badge bg-primary rounded-pill p-2"><i class="fas fa-gamepad"></i></span>
        Ahorcado
      </h3>

      <!-- Profile Image -->
      <div class="mb-4 position-relative d-inline-block animate-float">
        <div class="rounded-circle shadow-glow p-1 bg-white">
          {% if current_student.profile_picture %}
          <img src="{{ current_student.profile_picture.url }}" class="rounded-circle object-fit-cover"
            style="width: 140px; height: 140px; border: 4px solid white;" alt="Foto del alumno">
          {% else %}
          <div class="bg-light rounded-circle d-flex align-items-center justify-content-center mx-auto"
            style="width: 140px; height: 140px; border: 4px solid white;">
            <i class="fas fa-user fa-4x text-muted opacity-50"></i>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Hangman Progress -->
      <div class="card border-0 bg-light mb-4 shadow-inner rounded-4 overflow-hidden">
        <div class="card-body py-3 px-4">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <span class="text-muted small fw-bold text-uppercase">Intentos</span>
            <span class="fw-bold text-dark">{{ incorrect_count }}/{{ max_incorrect }}</span>
          </div>

          <div class="progress" style="height: 12px; border-radius: 10px; background-color: #e2e8f0;">
            {% with used=incorrect_count max=max_incorrect %}
            {% widthratio used max 100 as percentage %}
            <div id="hangman-progress"
              class="progress-bar progress-bar-striped progress-bar-animated {% if percentage|add:'0' > 70 %}bg-danger{% else %}bg-success{% endif %}"
              role="progressbar" style="width: {{ percentage }}%; transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);"
              aria-valuenow="{{ used }}" aria-valuemin="0" aria-valuemax="{{ max }}"></div>
            {% endwith %}
          </div>

          <div class="mt-2 fw-bold fs-4 animate-scale-in keyframe-bounce">
            {% if incorrect_count >= max_incorrect %}üòµ{% elif incorrect_count >= 1 %}üò∞{% else %}üòä{% endif %}
          </div>
        </div>
      </div>

      <!-- Word Display -->
      <div class="mb-5 py-3 position-relative">
        <h2 class="text-primary fw-bold mb-0 font-monospace tracking-widest display-5"
          style="word-break: break-word; letter-spacing: 0.2em;">
          {{ displayed_name }}
        </h2>
        <div class="position-absolute bottom-0 start-50 translate-middle-x w-50"
          style="height: 2px; background: radial-gradient(circle, var(--color-primary) 0%, transparent 100%); opacity: 0.2;">
        </div>
      </div>

      {% if not game_over %}
      <!-- Keyboard -->
      <form method="POST" class="mb-3 animate-slide-up delay-200">
        {% csrf_token %}
        <input type="hidden" name="action" value="guess_letter">

        <p class="text-muted small mb-3 fw-medium">Selecciona una letra:</p>
        <div class="d-flex flex-wrap justify-content-center gap-2">
          {% for letter in alphabet %}
          {% if letter in used_letters %}
          <button type="button" class="btn btn-light btn-sm fw-bold border" disabled
            style="width: 40px; height: 40px; border-radius: 12px; opacity: 0.4;">
            {{ letter }}
          </button>
          {% else %}
          <button type="submit" name="letter" value="{{ letter }}"
            class="btn btn-outline-primary btn-sm fw-bold shadow-sm hover-scale"
            style="width: 40px; height: 40px; border-radius: 12px;">
            {{ letter }}
          </button>
          {% endif %}
          {% endfor %}
        </div>
      </form>

      <div class="alert bg-blue-50 border-0 small text-blue-700 rounded-3 mt-4 d-flex align-items-center gap-2">
        <i class="fas fa-lightbulb text-warning"></i>
        <span><strong>Pista:</strong> Las tildes se descubren solas.</span>
      </div>

      {% else %}
      <!-- Game Over State -->
      <div class="mb-4 animate-scale-in">
        {% if won %}
        <div class="alert alert-success border-0 shadow-sm rounded-4 p-4">
          <div class="display-1 mb-3">üèÜ</div>
          <h4 class="alert-heading fw-bold">¬°Correcto!</h4>
          <p class="mb-0 fs-5">Era: <strong>{{ target_name }}</strong></p>
        </div>
        {% else %}
        <div class="alert alert-danger border-0 shadow-sm rounded-4 p-4">
          <div class="display-1 mb-3">üíÄ</div>
          <h4 class="alert-heading fw-bold">¬°Fin del juego!</h4>
          <p class="mb-0 fs-5">La respuesta era: <strong>{{ target_name }}</strong></p>
        </div>
        {% endif %}
      </div>

      <form method="POST" class="mb-3 animate-slide-up delay-300">
        {% csrf_token %}
        <input type="hidden" name="action" value="new_game">
        <button type="submit" class="btn btn-success btn-lg rounded-pill shadow-lg w-100 py-3 fw-bold">
          <i class="fas fa-redo me-2"></i> Siguiente Alumno
        </button>
      </form>
      {% endif %}

    </div>
  </div>

  <div class="text-center mt-4 mb-5 animate-fade-in delay-300">
    <a href="{% url 'teacher_home' %}" class="btn btn-link text-muted text-decoration-none">
      <i class="fas fa-home me-2"></i> Volver al panel
    </a>
  </div>

</div>

<style>
  .tracking-widest {
    letter-spacing: 0.2em;
  }

  .bg-blue-50 {
    background-color: #eff6ff;
  }

  .text-blue-700 {
    color: #1d4ed8;
  }

  .hover-scale {
    transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .hover-scale:hover {
    transform: scale(1.15);
    z-index: 10;
    background-color: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }

  .keyframe-bounce {
    animation: bounce 1s infinite;
  }

  @keyframes bounce {

    0%,
    100% {
      transform: translateY(0);
    }

    50% {
      transform: translateY(-5px);
    }
  }
</style>
{% endblock %}