{% extends "base.html" %}
{# Fixed target_name display #}
{% block title %}¿Quién es quién? | RELACIONA{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">

    <div class="text-center mb-4">
        <div class="d-inline-block px-4 py-2 bg-light rounded-pill border shadow-sm">
            <span class="text-muted small fw-bold text-uppercase me-2">Puntuación:</span>
            <span class="fw-bold" style="color: var(--color-blue-dark);">{{ correct }} / {{ total }}</span>
        </div>
    </div>

    <div class="text-center mb-5">
        <h2 class="fw-bold mb-2" style="color: var(--color-blue-dark);">
            ¿Quién es <span class="target-name-highlight">{{ target_name }}</span>?
        </h2>
        <p class="text-muted small">Toca la foto correcta</p>
    </div>

    <form method="POST" id="game-form">
        {% csrf_token %}
        <div class="row row-cols-2 g-3 justify-content-center">
            {% for student in options %}
            <div class="col">
                <div class="card h-100 shadow-sm border-0 option-card"
                    style="border-radius: var(--border-radius-xl); overflow: hidden;">
                    <button type="submit" name="selected_id" value="{{ student.id }}"
                        class="btn p-0 border-0 h-100 w-100 text-start" style="border-radius: var(--border-radius-xl);">
                        <div class="card-body p-3 d-flex flex-column align-items-center">

                            <div class="position-relative mb-3" style="width: 100%; padding-top: 100%;">
                                <div class="position-absolute top-0 start-0 w-100 h-100 rounded-circle overflow-hidden shadow-sm"
                                    style="border: 4px solid white;">
                                    {% if student.profile_picture %}
                                    <img src="{{ student.profile_picture.url }}" alt="Alumno"
                                        style="width: 100%; height: 100%; object-fit: cover;">
                                    {% else %}
                                    <div class="bg-light d-flex align-items-center justify-content-center w-100 h-100">
                                        <i class="fas fa-user-slash fa-2x text-muted"></i>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="mt-auto">
                                <span class="badge rounded-pill bg-light text-dark border">
                                    Ficha {{ forloop.counter }}
                                </span>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </form>

    <div class="d-grid gap-2 mt-5">
        <a href="{% url 'name_to_face_game' %}" class="btn btn-outline-primary rounded-pill">
            <i class="fas fa-sync-alt me-2"></i> Saltar Alumno
        </a>
        <a href="{% url 'teacher_home' %}" class="btn btn-outline-secondary rounded-pill">
            <i class="fas fa-home me-2"></i> Volver
        </a>
    </div>
</div>

<style>
    .target-name-highlight {
        color: var(--color-green);
        border-bottom: 3px solid var(--color-green);
    }

    .option-card {
        transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        background: white;
    }

    .option-card:active {
        transform: scale(0.95);
    }

    .option-card:hover {
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08) !important;
    }
</style>
{% endblock %}