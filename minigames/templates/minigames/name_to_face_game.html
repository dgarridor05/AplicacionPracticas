{% extends "base.html" %}
{# Fixed target_name display #}
{% block title %}¿Quién es quién? | RELACIONA{% endblock %}

{% block content %}
<div class="container mt-4" style="max-width: 600px;">

    <!-- Score Board -->
    <div class="text-center mb-5 animate-slide-up">
        <div class="d-inline-flex align-items-center px-4 py-2 bg-white rounded-pill shadow-sm border">
            <span class="text-muted small fw-bold text-uppercase me-2" style="letter-spacing: 1px;">Puntuación</span>
            <span class="fw-bold fs-5 text-primary">{{correct}} / {{total}}</span>
        </div>
    </div>

    <!-- Question Section -->
    <div class="text-center mb-5 animate-slide-up delay-100">
        <h2 class="fw-bold mb-2 display-6" style="color: var(--color-primary);">
            ¿Quién es <span class="position-relative d-inline-block text-accent">
                {{target_name}}
                <svg class="position-absolute w-100" style="bottom: -5px; left: 0; height: 6px; opacity: 0.3;"
                    viewBox="0 0 100 10" preserveAspectRatio="none">
                    <path d="M0 5 Q 50 10 100 5" stroke="var(--color-accent)" stroke-width="3" fill="none" />
                </svg>
            </span>?
        </h2>
        <p class="text-muted">Selecciona la fotografía correcta</p>
    </div>

    <form method="POST" id="game-form">
        {% csrf_token %}
        <div class="row row-cols-2 g-4 justify-content-center">
            {% for student in options %}
            <div class="col animate-scale-in" style="animation-delay: {{ forloop.counter0|add:2 }}00ms;">
                <div class="card h-100 border-0 shadow-sm option-card position-relative overflow-hidden">
                    <button type="submit" name="selected_id" value="{{student.id}}"
                        class="btn p-0 border-0 h-100 w-100 text-start bg-transparent">
                        <div class="card-body p-3 d-flex flex-column align-items-center">

                            <!-- Image Container -->
                            <div class="position-relative mb-3 w-100" style="padding-top: 100%;">
                                <div
                                    class="position-absolute top-0 start-0 w-100 h-100 rounded-circle overflow-hidden shadow-md image-wrapper">
                                    {% if student.profile_picture %}
                                    <img src="{{student.profile_picture.url}}" alt="Alumno"
                                        class="w-100 h-100 object-fit-cover transition-transform">
                                    {% else %}
                                    <div class="bg-light d-flex align-items-center justify-content-center w-100 h-100">
                                        <i class="fas fa-user fa-2x text-muted opacity-50"></i>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="mt-auto">
                                <span class="badge bg-light text-dark border fw-medium px-3 py-2 rounded-pill">
                                    Opción {{forloop.counter}}
                                </span>
                            </div>
                        </div>
                    </button>

                    <!-- Hover Overlay Effect -->
                    <div class="hover-overlay position-absolute top-0 start-0 w-100 h-100 pointer-events-none"></div>
                </div>
            </div>
            {% endfor %}
        </div>
    </form>

    <!-- Actions -->
    <div class="d-grid gap-3 mt-5 animate-slide-up delay-300">
        <a href="{% url 'name_to_face_game' %}" class="btn btn-light text-muted fw-medium rounded-pill py-3 hover-lift">
            <i class="fas fa-random me-2"></i>Saltar este alumno
        </a>
        <a href="{% url 'teacher_home' %}" class="btn btn-link text-muted text-decoration-none small">
            <i class="fas fa-arrow-left me-1"></i>Volver al inicio
        </a>
    </div>
</div>

<style>
    .text-accent {
        color: var(--color-accent);
    }

    .option-card {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: white;
    }

    .option-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 30px -5px rgba(0, 0, 0, 0.1) !important;
    }

    .option-card:hover .image-wrapper {
        box-shadow: 0 0 0 4px var(--color-accent);
    }

    .option-card:hover img {
        transform: scale(1.1);
    }

    .image-wrapper {
        border: 4px solid white;
        transition: all 0.3s ease;
    }

    .transition-transform {
        transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .hover-lift:hover {
        transform: translateY(-2px);
        background-color: #f1f5f9;
    }
</style>
{% endblock %}