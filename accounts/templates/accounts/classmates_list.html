{% extends "base.html" %}
{% block title %}Compañeros de clase | RELACIONA{% endblock %}

{% block content %}
<div class="container mt-4 pb-5" style="max-width: 800px;">

  <div class="text-center mb-5 animate-slide-up">
    <h2 class="fw-bold mb-2" style="color: var(--color-blue-dark);">Mis Compañeros de Clase</h2>
    <p class="text-muted">Descubre los perfiles y estilos de aprendizaje de tu grupo.</p>
    <div class="mx-auto" style="width: 60px; height: 4px; background: var(--color-green); border-radius: 2px;"></div>
  </div>

  <div class="mb-4 animate-slide-up" style="animation-delay: 100ms;">
    <div class="input-group shadow-sm rounded-pill overflow-hidden border">
      <span class="input-group-text bg-white border-0 ps-3">
        <i class="fas fa-search text-muted"></i>
      </span>
      <input type="text" id="classmateSearch" class="form-control border-0 py-2 shadow-none"
        placeholder="Buscar por nombre o apodo...">
    </div>
  </div>

  <div id="classmatesList" class="animate-slide-up" style="animation-delay: 200ms;">
    {% if classmates %}
    <div class="row g-3">
      {% for classmate in classmates %}
      <div class="col-12 classmate-card">
        <a href="{% url 'public_student_profile' classmate.id %}"
          class="text-decoration-none card h-100 border-0 shadow-sm hover-row transition-all"
          style="border-radius: 15px;">
          <div class="card-body d-flex align-items-center p-3">

            <div class="me-3">
              {% if classmate.profile_picture %}
              <img src="{{ classmate.profile_picture.url }}" class="rounded-circle object-fit-cover shadow-sm"
                style="width: 50px; height: 50px; border: 2px solid white;" alt="Foto">
              {% else %}
              <div class="bg-light text-muted rounded-circle d-flex align-items-center justify-content-center shadow-sm"
                style="width: 50px; height: 50px; border: 2px solid white;">
                <i class="fas fa-user"></i>
              </div>
              {% endif %}
            </div>

            <div class="flex-grow-1">
              <h6 class="mb-0 fw-bold text-dark name-text">
                {{ classmate.nickname|default:classmate.username }}
                <span class="d-none">{{ classmate.get_full_name }} {{ classmate.username }}</span>
              </h6>
              <small class="text-muted text-uppercase" style="font-size: 0.7rem; letter-spacing: 0.5px;">
                {% if classmate.vark_result %}
                <i class="fas fa-brain text-success me-1"></i> {{ classmate.vark_result }}
                {% else %}
                <i class="fas fa-circle-notch fa-spin me-1"></i> Perfil pendiente
                {% endif %}
              </small>
            </div>

            <div class="ms-2">
              <span class="badge rounded-pill px-3 py-2 bg-light text-success border">
                Ver perfil <i class="fas fa-chevron-right ms-1 small"></i>
              </span>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="card border-0 shadow-sm text-center p-5" style="border-radius: 20px;">
      <div class="opacity-25 mb-3">
        <i class="fas fa-users-slash fa-4x text-muted"></i>
      </div>
      <h5 class="text-muted">Ningún compañero ha compartido su perfil todavía.</h5>
      <p class="small text-muted mb-0">¡Anima a tus compañeros a unirse!</p>
    </div>
    {% endif %}
  </div>

  <div class="text-center mt-5">
    <a href="{% url 'student_home' %}" class="btn btn-light rounded-pill px-4 border shadow-sm transition-all">
      <i class="fas fa-arrow-left me-2"></i> Volver al panel
    </a>
  </div>
</div>

<style>
  .hover-row {
    transition: all 0.2s ease-in-out;
    border-left: 4px solid transparent !important;
  }

  .hover-row:hover {
    transform: translateX(5px);
    background-color: #f8fff9 !important;
    border-left: 4px solid var(--color-green) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
  }

  .object-fit-cover {
    object-fit: cover;
  }

  .transition-all {
    transition: all 0.3s ease;
  }

  /* Animación de entrada */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-slide-up {
    animation: fadeInUp 0.5s ease backwards;
  }
</style>

<script>
  // Buscador interactivo
  document.getElementById('classmateSearch').addEventListener('keyup', function () {
    const value = this.value.toLowerCase();
    const cards = document.querySelectorAll('.classmate-card');

    cards.forEach(card => {
      const name = card.querySelector('.name-text').innerText.toLowerCase();
      if (name.includes(value)) {
        card.style.display = "block";
        card.style.animation = "none"; // Evita que se repita la animación al buscar
      } else {
        card.style.display = "none";
      }
    });
  });
</script>
{% endblock %}