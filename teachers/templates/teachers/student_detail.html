{% extends "base.html" %}
{% block title %}Perfil del Alumno{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="text-center mb-4">
    {% if student.profile_picture %}
      <img src="{{ student.profile_picture.url }}" alt="Foto de perfil" class="img-thumbnail rounded-circle shadow-sm border border-success p-1" style="max-width: 150px; width: 150px; height: 150px; object-fit: cover;">
    {% else %}
      <div class="bg-light rounded-circle d-inline-block d-flex align-items-center justify-content-center mx-auto" style="width: 150px; height: 150px; border: 2px dashed #198754;">
        <i class="fas fa-user fa-3x text-muted"></i>
      </div>
    {% endif %}
  </div>

  <h2 class="mb-4 text-success text-center">Perfil de {{ student.nickname|default:student.username }}</h2>

  <div class="card shadow-lg mb-4 border-0" style="border-radius: 15px;">
    <div class="card-body p-4">
      <h5 class="text-success border-bottom pb-2 mb-3"><i class="fas fa-info-circle me-2"></i>Información Personal</h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Nombre de usuario:</strong> {{ student.username }}</li>
        <li class="list-group-item"><strong>Apodo:</strong> {{ student.nickname|default:"No especificado" }}</li>
        <li class="list-group-item"><strong>Zona de residencia:</strong> {{ student.residence_area|default:"No especificada" }}</li>
        <li class="list-group-item"><strong>Fecha de nacimiento:</strong> {{ student.date_of_birth|date:"j \\d\\e F \\d\\e Y"|default:"No especificada" }}</li>
        <li class="list-group-item"><strong>¿Celebrar cumpleaños?:</strong> {{ student.celebrate_birthday|yesno:"Sí,No" }}</li>
      </ul>

      <h5 class="text-success border-bottom pb-2 mt-4 mb-3"><i class="fas fa-graduation-cap me-2"></i>Aprendizaje</h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Método de aprendizaje:</strong> {{ student.learning_style|default:"No especificado" }}</li>
        <li class="list-group-item"><strong>Refuerzo emocional:</strong> {{ student.emotional_reinforcement|default:"No especificado" }}</li>
        <li class="list-group-item">
          <strong>Estilo VARK:</strong>
          {% if vark_result %}
            <span class="badge bg-success">
            {% if vark_result.dominant_category == 'V' %} Visual
            {% elif vark_result.dominant_category == 'A' %} Auditivo
            {% elif vark_result.dominant_category == 'R' %} Lectura/Escritura
            {% elif vark_result.dominant_category == 'K' %} Kinestésico
            {% else %} {{ vark_result.dominant_category }}
            {% endif %}
            </span>
          {% else %}
            <span class="text-muted">Sin resultado aún</span>
          {% endif %}
        </li>
      </ul>

      <h5 class="text-success border-bottom pb-2 mt-4 mb-3"><i class="fas fa-heart me-2"></i>Gustos y Reflexiones</h5>
      <ul class="list-group list-group-flush">
        <li class="list-group-item">
            <strong>Canción favorita:</strong> {{ student.favorite_song|default:"No especificada" }}
            {% if student.spotify_embed_url %}
            <div class="mt-3">
                <iframe style="border-radius:12px" 
                        src="{{ student.spotify_embed_url }}" 
                        width="100%" height="80" 
                        frameBorder="0" 
                        allowfullscreen="" 
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                        loading="lazy">
                </iframe>
            </div>
            {% endif %}
        </li>
        <li class="list-group-item"><strong>Artista favorito:</strong> {{ student.favorite_artist|default:"No especificado" }}</li>
        <li class="list-group-item"><strong>Película favorita:</strong> {{ student.favorite_movie|default:"No especificada" }}</li>
        <li class="list-group-item"><strong>Motivación:</strong> {{ student.motivation|default:"No especificada" }}</li>
        <li class="list-group-item"><strong>¿Por qué está más agradecido?:</strong> {{ student.gratitude|default:"No compartido aún" }}</li>
        <li class="list-group-item"><strong>Recuerdo más feliz:</strong> {{ student.happy_memory|default:"No compartido aún" }}</li>
        <li class="list-group-item"><strong>¿Comparte con la clase?:</strong> {{ student.share_with_class|yesno:"Sí,No" }}</li>
      </ul>
    </div>
  </div>

  {% if group %}
    <div class="text-center">
      <a href="{% url 'group_detail' group.id %}" class="btn btn-outline-secondary px-4">
        <i class="fas fa-arrow-left me-2"></i>Volver al grupo
      </a>
    </div>
  {% else %}
    <div class="text-center text-muted">Este alumno no está asignado a ningún grupo.</div>
  {% endif %}
</div>
{% endblock %}